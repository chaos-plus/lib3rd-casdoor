(self.webpackChunkweb=self.webpackChunkweb||[]).push([[6495],{97578:function(e,t,n){"use strict";n.r(t),n.d(t,{authViaMetaMask:function(){return D},authViaWeb3Onboard:function(){return E},checkEthereumSignedTypedData:function(){return I},clearWeb3AuthToken:function(){return W},delWeb3AuthToken:function(){return M},detectMetaMaskPlugin:function(){return S},generateNonce:function(){return v},getWeb3AuthToken:function(){return Z},getWeb3AuthTokenKey:function(){return A},getWeb3OnboardWalletsOptions:function(){return N},initWeb3Onboard:function(){return B},requestEthereumAccount:function(){return O},setWeb3AuthToken:function(){return T},signEthereumTypedData:function(){return x}});var a=n(74165),r=n(29439),o=n(15861),i=n(3548),u=n(96351),c=n(95162),s=n(2109),l=n(20293),d=n(40918),f=n(7826),p=n(34530),h=n(24054),b=n(20913),m=n(23328),g=n(35068),w=n(68943),y=n(85708),k=n(63601);function v(){return(0,c.Z)()}function A(e){return"Web3AuthToken_".concat(e)}function T(e){var t=A(e.address);localStorage.setItem(t,JSON.stringify(e))}function Z(e){var t=A(e);return JSON.parse(localStorage.getItem(t))}function M(e){var t=A(e);localStorage.removeItem(t)}function W(){Object.keys(localStorage).forEach((function(e){e.startsWith("Web3AuthToken_")&&localStorage.removeItem(e)}))}function S(){return window.ethereum&&window.ethereum.isMetaMask}function O(){return window.ethereum.request({method:"eth_requestAccounts"}).then((function(e){return e[0]}))}function x(e,t){var n=new Date,a=JSON.stringify({domain:{chainId:window.ethereum.chainId,name:"Casdoor",version:"1"},message:{prompt:"In order to authenticate to this website, sign this request and your public address will be sent to the server in a verifiable way.",nonce:t,createAt:"".concat(n.toLocaleString())},primaryType:"AuthRequest",types:{EIP712Domain:[{name:"name",type:"string"},{name:"version",type:"string"},{name:"chainId",type:"uint256"}],AuthRequest:[{name:"prompt",type:"string"},{name:"nonce",type:"string"},{name:"createAt",type:"string"}]}}),r=[e,a];return window.ethereum.request({method:"eth_signTypedData_v4",params:r}).then((function(t){return{address:e,createAt:Math.floor(n.getTime()/1e3),typedData:a,signature:t}}))}function I(e){return void 0!==e&&null!==e&&(!!(e.address&&e.typedData&&e.signature)&&(0,s.recoverTypedSignature)({data:JSON.parse(e.typedData),signature:e.signature,version:s.SignTypedDataVersion.V4})===e.address)}function D(e,t,n){return q.apply(this,arguments)}function q(){return(q=(0,o.Z)((0,a.Z)().mark((function e(t,n,r){var o,c,s;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(S()){e.next=3;break}return(0,i.PV)("error","".concat(u.Z.t("login:MetaMask plugin not detected"))),e.abrupt("return");case 3:return e.prev=3,e.next=6,O();case 6:if(o=e.sent,I(Z(o))){e.next=14;break}return c=v(),e.next=12,x(o,c);case 12:T(e.sent);case 14:s="".concat((0,l.N6)(t,n,r),"&web3AuthTokenKey=").concat(A(o)),(0,i.iF)(s),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(3),(0,i.PV)("error","".concat(u.Z.t("login:Failed to obtain MetaMask authorization"),": ").concat(e.t0.message));case 21:case"end":return e.stop()}}),e,null,[[3,18]])})))).apply(this,arguments)}n.g.Buffer=d.Buffer;var C={injected:{label:"Injected",wallet:(0,p.ZP)()},coinbase:{label:"Coinbase",wallet:(0,y.Z)()},trust:{label:"Trust",wallet:(0,m.Z)()},gnosis:{label:"Gnosis",wallet:(0,k.Z)()},sequence:{label:"Sequence",wallet:(0,b.Z)()},taho:{label:"Taho",wallet:(0,w.Z)()},frontier:{label:"Frontier",wallet:(0,g.Z)()},infinityWallet:{label:"Infinity Wallet",wallet:(0,h.Z)()}};function N(){return Object.entries(C).map((function(e){var t=(0,r.Z)(e,2),n=t[0];return{label:t[1].label,value:n}}))}function B(e,t){var n=function(e){return null!==e&&void 0!==e&&Array.isArray(e)?e.map((function(e){var t,n;if(e&&null!==(t=C[e])&&void 0!==t&&t.wallet)return null===(n=C[e])||void 0===n?void 0:n.wallet})):[]}(JSON.parse(t.metadata));return(0,f.Z)({wallets:n,chains:[{id:"0x13881",token:"MATIC",label:"Polygon - Mumbai",rpcUrl:"https://matic-mumbai.chainstacklabs.com"},{id:"0x38",token:"BNB",label:"Binance",rpcUrl:"https://bsc-dataseed.binance.org/"},{id:"0xA",token:"OETH",label:"Optimism",rpcUrl:"https://mainnet.optimism.io"},{id:"0xA4B1",token:"ARB-ETH",label:"Arbitrum",rpcUrl:"https://rpc.ankr.com/arbitrum"}],appMetadata:{name:"Casdoor",description:"Connect a wallet using Casdoor",recommendedInjectedWallets:[{name:"MetaMask",url:"https://metamask.io"},{name:"Coinbase",url:"https://www.coinbase.com/wallet"}]}})}function E(e,t,n){return P.apply(this,arguments)}function P(){return(P=(0,o.Z)((0,a.Z)().mark((function e(t,n,r){var o,c,s,d,f,p;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o=B(0,n),e.next=4,o.connectWallet();case 4:(c=e.sent).length>0&&(s=c[0],d=s.accounts[0],f=d.address,T({address:f,walletType:s.label,createAt:Math.floor((new Date).getTime()/1e3)}),p="".concat((0,l.N6)(t,n,r),"&web3AuthTokenKey=").concat(A(f)),(0,i.iF)(p)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),(0,i.PV)("error","".concat(u.Z.t("login:Failed to obtain Web3-Onboard authorization"),": ").concat(e.t0));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}},993:function(){},32772:function(){},44814:function(){},68329:function(){},5612:function(){},46601:function(){},72260:function(){},72895:function(){},13121:function(){},31865:function(){}}]);